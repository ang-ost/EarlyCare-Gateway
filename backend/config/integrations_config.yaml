# Clinical System Integration Configuration

# HL7 v2.x Configuration
hl7:
  enabled: true
  version: "2.5"
  
  # Connection settings
  connection:
    host: "hl7.hospital.local"
    port: 2575
    transport: "MLLP"  # Minimal Lower Layer Protocol
    
  # Application identifiers
  sending_application: "EARLYCARE"
  sending_facility: "GATEWAY"
  receiving_application: "HOSPITAL_EMR"
  receiving_facility: "MAIN"
  
  # Message types
  supported_messages:
    - "ADT^A01"  # Admit patient
    - "ADT^A08"  # Update patient
    - "ORU^R01"  # Observation result
    - "QRY^A19"  # Query patient
    
  # Export settings
  export:
    format_results_as: "ORU^R01"
    include_observations: true

# FHIR R4 Configuration
fhir:
  enabled: true
  version: "R4"
  
  # Server connection
  server:
    base_url: "https://fhir.hospital.org/api/r4"
    auth_type: "oauth2"  # oauth2, api_key, basic
    api_key: ""  # Set via environment variable
    
  # OAuth2 settings (if auth_type = oauth2)
  oauth2:
    token_url: "https://auth.hospital.org/token"
    client_id: ""
    client_secret: ""
    scopes:
      - "patient/*.read"
      - "patient/*.write"
      
  # Resources to import
  import_resources:
    - "Patient"
    - "Observation"
    - "DiagnosticReport"
    - "DocumentReference"
    - "Condition"
    - "MedicationRequest"
    
  # Export settings
  export:
    create_diagnostic_report: true
    create_clinical_impression: true
    update_patient_conditions: false
    
  # Search parameters
  search:
    max_results: 100
    include_revisions: false

# DICOM Configuration
dicom:
  enabled: true
  
  # PACS connection
  pacs:
    ae_title: "EARLYCARE_SCU"
    peer_ae_title: "HOSPITAL_PACS"
    host: "pacs.hospital.local"
    port: 11112
    
  # Query/Retrieve settings
  query_retrieve:
    query_level: "STUDY"  # PATIENT, STUDY, SERIES, IMAGE
    max_results: 50
    
  # Storage settings
  storage:
    local_path: "data/dicom"
    anonymize_on_import: true
    
  # Supported modalities
  modalities:
    - "CT"
    - "MR"
    - "CR"
    - "DX"
    - "US"
    - "XA"
    
  # Export settings
  export:
    enabled: false
    destination_ae: "EXTERNAL_PACS"

# Integration Workflows
workflows:
  # Automatic import on patient admission
  auto_import:
    enabled: false
    trigger: "hl7_adt_a01"
    import_from:
      - "fhir"
      - "dicom"
    
  # Automatic export of results
  auto_export:
    enabled: true
    destinations:
      - type: "fhir"
        resource: "DiagnosticReport"
      - type: "hl7"
        message_type: "ORU^R01"
        
  # Data synchronization
  sync:
    enabled: false
    interval_minutes: 60
    bidirectional: false

# Error Handling
error_handling:
  retry_attempts: 3
  retry_delay_seconds: 5
  timeout_seconds: 30
  log_errors: true
  alert_on_failure: true

# Connection Pooling
connection_pool:
  enabled: true
  max_connections: 10
  idle_timeout_seconds: 300

# Rate Limiting
rate_limiting:
  enabled: true
  requests_per_minute:
    hl7: 100
    fhir: 60
    dicom: 30
